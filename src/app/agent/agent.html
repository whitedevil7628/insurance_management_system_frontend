<div class="agent-dashboard">
  <!-- Notification -->
  <div class="notification" [class.show]="showNotification" [class.success]="notificationType === 'success'" [class.error]="notificationType === 'error'">
    <div class="notification-content">
      <i class="fas fa-check-circle" *ngIf="notificationType === 'success'"></i>
      <i class="fas fa-exclamation-circle" *ngIf="notificationType === 'error'"></i>
      <span>{{ notificationMessage }}</span>
    </div>
  </div>
  <!-- Notification -->
  <div class="notification" [class.show]="showNotification" [class.success]="notificationType === 'success'" [class.error]="notificationType === 'error'">
    <div class="notification-content">
      <i class="fas fa-check-circle" *ngIf="notificationType === 'success'"></i>
      <i class="fas fa-exclamation-circle" *ngIf="notificationType === 'error'"></i>
      <span>{{ notificationMessage }}</span>
      <button class="notification-close" (click)="showNotification = false">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="brand">
        <i class="fas fa-shield-alt"></i>
        <span>SecureLife</span>
      </div>
    </div>
    <nav class="sidebar-nav">
      <ul>
        <li [class.active]="activeSection === 'claims'" (click)="setActiveSection('claims')">
          <i class="fas fa-file-medical"></i>
          <span>All Claims</span>
        </li>
        <li [class.active]="activeSection === 'profile'" (click)="setActiveSection('profile')">
          <i class="fas fa-user"></i>
          <span>Profile</span>
        </li>
        <li [class.active]="activeSection === 'help'" (click)="setActiveSection('help')">
          <i class="fas fa-question-circle"></i>
          <span>Help</span>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Navbar -->
    <header class="top-navbar">
      <div class="navbar-left">
        <div class="user-avatar">
          {{getAgentInitials()}}
        </div>
        <span class="user-name">{{agentData?.name || 'Agent'}}</span>
      </div>
      
      <div class="navbar-center">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search claims...">
        </div>
      </div>
      
      <div class="navbar-right">
        <div class="notification-dropdown">
          <button class="notification-btn" (click)="toggleNotifications()">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" *ngIf="notifications.length > 0">{{notifications.length}}</span>
          </button>
          
          <div class="notification-panel" *ngIf="showNotificationPanel">
            <div class="notification-header">
              <h4>Notifications</h4>
              <div class="notification-actions">
                <button class="refresh-btn" (click)="loadNotifications()" title="Refresh">
                  <i class="fas fa-sync-alt"></i>
                </button>
                <button class="close-btn" (click)="showNotificationPanel = false">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            
            <div class="notification-list" *ngIf="notifications.length > 0">
              <div class="notification-item" *ngFor="let notif of notifications; let i = index">
                <div class="notif-dot"></div>
                <div class="notif-content" (click)="toggleNotificationExpand(i)">
                  <div class="notif-header">
                    <h5>{{notif.subject}}</h5>
                    <i class="fas" [class.fa-chevron-down]="!notif.expanded" [class.fa-chevron-up]="notif.expanded"></i>
                  </div>
                  <p class="notif-preview" *ngIf="!notif.expanded">{{notif.details | slice:0:40}}...</p>
                  <div class="notif-details" *ngIf="notif.expanded">
                    <p>{{notif.details}}</p>
                    <div class="notif-actions">
                      <span class="notif-type">{{notif.type}}</span>
                      <button class="mark-read-btn" (click)="markAsRead(notif, $event)">Mark as Read</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="no-notifications" *ngIf="notifications.length === 0">
              <i class="fas fa-bell-slash"></i>
              <p>No notifications</p>
            </div>
          </div>
        </div>
        
        <button class="logout-btn" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          Logout
        </button>
      </div>
    </header>

    <!-- Content Area -->
    <div class="content-area">
      <!-- All Claims Section -->
      <div *ngIf="activeSection === 'claims'" class="section">
        <div class="section-header">
          <h2>All Claims</h2>
          <p>Manage and review insurance claims from customers</p>
        </div>
        
        <div class="claims-container">
          <div class="claims-grid" *ngIf="claims.length > 0">
            <div class="claim-card enhanced" *ngFor="let claim of claims" (click)="openClaimModal(claim)">
              <div class="claim-status-indicator" 
                   [class.status-approved]="claim.status === 'APPROVED'"
                   [class.status-rejected]="claim.status === 'REJECTED'"
                   [class.status-filed]="claim.status === 'FILED'"></div>
              
              <div class="claim-header">
                <div class="claim-icon" 
                     [class.approved]="claim.status === 'APPROVED'"
                     [class.rejected]="claim.status === 'REJECTED'"
                     [class.filed]="claim.status === 'FILED'">
                  <i class="fas fa-file-medical"></i>
                </div>
                <div class="claim-info">
                  <h3>Claim #{{claim.claimId}}</h3>
                  <p><i class="fas fa-shield-alt"></i> Policy ID: {{claim.policyId}}</p>
                </div>
                <div class="claim-amount">
                  <span class="amount-label">Amount</span>
                  <span class="amount-value">â‚¹{{claim.claimAmount | number}}</span>
                </div>
              </div>
              
              <div class="claim-details">
                <div class="detail-row">
                  <div class="detail-item">
                    <i class="fas fa-user"></i>
                    <span class="label">Customer ID:</span>
                    <span class="value">{{claim.customerId}}</span>
                  </div>
                  <div class="detail-item">
                    <i class="fas fa-info-circle"></i>
                    <span class="label">Status:</span>
                    <span class="status-badge" 
                          [class.status-approved]="claim.status === 'APPROVED'"
                          [class.status-rejected]="claim.status === 'REJECTED'"
                          [class.status-filed]="claim.status === 'FILED'">
                      <i class="fas fa-check-circle" *ngIf="claim.status === 'APPROVED'"></i>
                      <i class="fas fa-times-circle" *ngIf="claim.status === 'REJECTED'"></i>
                      <i class="fas fa-clock" *ngIf="claim.status === 'FILED'"></i>
                      {{claim.status}}
                    </span>
                  </div>
                </div>
              </div>
              
              <div class="claim-footer">
                <span class="view-details">Click to view details <i class="fas fa-arrow-right"></i></span>
              </div>
            </div>
          </div>
          
          <div class="empty-state" *ngIf="claims.length === 0">
            <i class="fas fa-file-medical"></i>
            <h3>No Claims Available</h3>
            <p>There are currently no claims to review.</p>
          </div>
        </div>
      </div>

      <!-- Profile Section -->
      <div *ngIf="activeSection === 'profile'" class="section">
        <div class="section-header">
          <h2>Agent Profile</h2>
          <p>View and manage your agent information</p>
        </div>
        
        <div class="profile-container">
          <div class="profile-card">
            <div class="profile-header">
              <div class="profile-avatar">
                {{getAgentInitials()}}
              </div>
              <div class="profile-info">
                <h3>{{agentData?.name || 'Agent Name'}}</h3>
                <p>Agent ID: {{agentData?.agentId || 'N/A'}}</p>
              </div>
            </div>
            
            <div class="profile-form">
              <div class="form-grid">
                <div class="form-group">
                  <label>Full Name</label>
                  <input type="text" [value]="agentData?.name || ''" readonly class="readonly">
                </div>
                <div class="form-group">
                  <label>Email Address</label>
                  <input type="email" [value]="agentData?.orgEmail || ''" readonly class="readonly">
                </div>
                <div class="form-group">
                  <label>Contact Info</label>
                  <input type="text" [value]="agentData?.contactInfo || ''" readonly class="readonly">
                </div>
                <div class="form-group">
                  <label>Phone</label>
                  <input type="text" [value]="agentData?.phone || ''" readonly class="readonly">
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <input type="text" [value]="agentData?.gender || ''" readonly class="readonly">
                </div>
                <div class="form-group">
                  <label>Date of Birth</label>
                  <input type="text" [value]="agentData?.date || ''" readonly class="readonly">
                </div>
              </div>
              <div class="form-group">
                <label>Address</label>
                <textarea [value]="agentData?.address || ''" readonly class="readonly" rows="2"></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Help Section -->
      <div *ngIf="activeSection === 'help'" class="section">
        <div class="section-header">
          <h2>Help & Support</h2>
          <p>Get assistance with agent portal and claim processing</p>
        </div>
        
        <div class="help-container">
          <div class="help-card">
            <div class="help-header">
              <i class="fas fa-envelope"></i>
              <h3>Contact Admin</h3>
            </div>
            <div class="help-content">
              <p>Need help with the agent portal? Contact our admin team.</p>
              <a href="mailto:admin@securelife.com?subject=Agent Support Request" class="btn-primary">
                <i class="fas fa-paper-plane"></i>
                Send Email to Admin
              </a>
            </div>
          </div>
          
          <div class="help-card">
            <div class="help-header">
              <i class="fas fa-phone"></i>
              <h3>Agent Hotline</h3>
            </div>
            <div class="help-content">
              <p>Call our agent support hotline:</p>
              <p class="phone-number">1-800-AGENT (1-800-243-68)</p>
              <p class="hours">Available 24/7</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Enhanced Claim Details Modal -->
  <div class="modal-overlay enhanced" *ngIf="showClaimModal" (click)="closeClaimModal()">
    <div class="modal-content enhanced" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="modal-header enhanced">
        <div class="header-content">
          <div class="claim-badge">
            <i class="fas fa-file-medical"></i>
            <span>Claim #{{selectedClaim?.claimId}}</span>
          </div>
          <div class="status-indicator" 
               [class.status-approved]="selectedClaim?.status === 'APPROVED'"
               [class.status-rejected]="selectedClaim?.status === 'REJECTED'"
               [class.status-filed]="selectedClaim?.status === 'FILED'">
            <i class="fas fa-check-circle" *ngIf="selectedClaim?.status === 'APPROVED'"></i>
            <i class="fas fa-times-circle" *ngIf="selectedClaim?.status === 'REJECTED'"></i>
            <i class="fas fa-clock" *ngIf="selectedClaim?.status === 'FILED'"></i>
            {{selectedClaim?.status}}
          </div>
        </div>
        <button class="close-btn enhanced" (click)="closeClaimModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="claim-modal-content enhanced">
        <!-- Claim Summary Card -->
        <div class="summary-card">
          <div class="summary-header">
            <h3>Claim Summary</h3>
            <div class="amount-display">
              <span class="currency">â‚¹</span>
              <span class="amount">{{selectedClaim?.claimAmount | number}}</span>
            </div>
          </div>
          <div class="summary-details">
            <div class="detail-chip">
              <i class="fas fa-hashtag"></i>
              <span>ID: {{selectedClaim?.claimId}}</span>
            </div>
            <div class="detail-chip">
              <i class="fas fa-shield-alt"></i>
              <span>Policy: {{selectedClaim?.policyId}}</span>
            </div>
          </div>
        </div>

        <!-- Information Cards Grid -->
        <div class="info-cards-grid">
          <!-- Customer Card -->
          <div class="info-card customer-card" *ngIf="claimDetails.customer">
            <div class="card-header">
              <div class="card-icon customer">
                <i class="fas fa-user"></i>
              </div>
              <h4>Customer Details</h4>
            </div>
            <div class="card-content">
              <div class="info-row">
                <i class="fas fa-id-badge"></i>
                <span class="label">ID:</span>
                <span class="value">{{claimDetails.customer.customerId}}</span>
              </div>
              <div class="info-row">
                <i class="fas fa-user-circle"></i>
                <span class="label">Name:</span>
                <span class="value">{{claimDetails.customer.name}}</span>
              </div>
              <div class="info-row">
                <i class="fas fa-envelope"></i>
                <span class="label">Email:</span>
                <span class="value">{{claimDetails.customer.email}}</span>
              </div>
              <div class="info-row">
                <i class="fas fa-phone"></i>
                <span class="label">Phone:</span>
                <span class="value">{{claimDetails.customer.phone}}</span>
              </div>
              <div class="info-row">
                <i class="fas fa-id-card"></i>
                <span class="label">Aadhaar:</span>
                <span class="value">{{claimDetails.customer.aadharnumber}}</span>
              </div>
              <div class="info-row address">
                <i class="fas fa-map-marker-alt"></i>
                <span class="label">Address:</span>
                <span class="value">{{claimDetails.customer.address}}</span>
              </div>
            </div>
          </div>

          <!-- Policy Card -->
          <div class="info-card policy-card" *ngIf="claimDetails.policy">
            <div class="card-header">
              <div class="card-icon policy">
                <i class="fas fa-file-contract"></i>
              </div>
              <h4>Policy Details</h4>
            </div>
            <div class="card-content">
              <div class="info-row">
                <i class="fas fa-hashtag"></i>
                <span class="label">Policy ID:</span>
                <span class="value">{{claimDetails.policy.policyId}}</span>
              </div>
              <div class="info-row">
                <i class="fas fa-tag"></i>
                <span class="label">Name:</span>
                <span class="value">{{claimDetails.policy.name}}</span>
              </div>
              <div class="info-row">
                <i class="fas fa-rupee-sign"></i>
                <span class="label">Premium:</span>
                <span class="value">â‚¹{{claimDetails.policy.premiumAmount | number}}</span>
              </div>
              <div class="info-row">
                <i class="fas fa-shield-check"></i>
                <span class="label">Coverage:</span>
                <span class="value">{{claimDetails.policy.coverageDetails}}</span>
              </div>
              <div class="info-row">
                <i class="fas fa-calendar-alt"></i>
                <span class="label">Validity:</span>
                <span class="value">{{claimDetails.policy.validityPeriod}} years</span>
              </div>
              <div class="info-row">
                <i class="fas fa-calendar-plus"></i>
                <span class="label">Entry Date:</span>
                <span class="value">{{claimDetails.policy.entryDate}}</span>
              </div>
              <div class="info-row">
                <i class="fas fa-calendar-times"></i>
                <span class="label">Expiry Date:</span>
                <span class="value">{{claimDetails.policy.expiryDate}}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="modal-actions enhanced" *ngIf="selectedClaim && !isClaimProcessed(selectedClaim.status)">
          <button class="btn-reject enhanced" (click)="rejectClaim(selectedClaim.claimId)">
            <i class="fas fa-times-circle"></i>
            <span>Reject Claim</span>
          </button>
          <button class="btn-approve enhanced" (click)="approveClaim(selectedClaim.claimId)">
            <i class="fas fa-check-circle"></i>
            <span>Approve Claim</span>
          </button>
        </div>
        
        <!-- Status Message for Processed Claims -->
        <div class="claim-status-message enhanced" *ngIf="selectedClaim && isClaimProcessed(selectedClaim.status)">
          <div class="status-icon-large" [class.approved]="selectedClaim.status === 'APPROVED'" [class.rejected]="selectedClaim.status === 'REJECTED'">
            <i class="fas" [class.fa-check-circle]="selectedClaim.status === 'APPROVED'" [class.fa-times-circle]="selectedClaim.status === 'REJECTED'"></i>
          </div>
          <div class="status-text">
            <h3>Claim {{selectedClaim.status | titlecase}}</h3>
            <p>This claim has been processed and marked as <strong>{{selectedClaim.status.toLowerCase()}}</strong></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
