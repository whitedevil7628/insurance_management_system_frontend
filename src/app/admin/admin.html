<div class="d-flex vh-100">
  <!-- Notification -->
  @if (showNotification()) {
  <div
    class="alert position-fixed top-0 end-0 m-3"
    [class.alert-success]="notificationType() === 'success'"
    [class.alert-danger]="notificationType() === 'error'"
    style="z-index: 1050; min-width: 300px"
  >
    @if (notificationType() === 'success') {
    <i class="fas fa-check-circle me-2"></i>
    } @if (notificationType() === 'error') {
    <i class="fas fa-exclamation-circle me-2"></i>
    }
    {{ notificationMessage() }}
  </div>
  }

  <!-- Enhanced Sidebar -->
  <div
    class="sidebar d-flex flex-column shadow-lg"
    style="min-width: 300px; max-width: 300px; background: white"
  >
    <div class="p-4 border-bottom">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <h4 class="mb-0 fw-bold" style="color: #2c5aa0">
            <i class="fas fa-shield-alt me-2" style="color: #2c5aa0"></i>
            Admin Panel
          </h4>
          <small class="text-muted">System Management</small>
        </div>
      </div>
    </div>
    <nav class="flex-grow-1 p-3">
      <ul class="nav flex-column gap-2">
        <li class="nav-item">
          <a
            class="nav-link d-flex align-items-center"
            [class.active]="activeTab() === 'dashboard'"
            (click)="setActiveTab('dashboard')"
            style="cursor: pointer"
          >
            <div
              class="icon-wrapper me-3"
              style="
                width: 40px;
                height: 40px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(44, 90, 160, 0.1);
              "
            >
              <i class="fas fa-tachometer-alt" style="color: #2c5aa0"></i>
            </div>
            <div>
              <div class="fw-semibold">Dashboard</div>
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link d-flex align-items-center"
            [class.active]="activeTab() === 'agents'"
            (click)="setActiveTab('agents')"
            style="cursor: pointer"
          >
            <div
              class="icon-wrapper me-3"
              style="
                width: 40px;
                height: 40px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(44, 90, 160, 0.1);
              "
            >
              <i class="fas fa-users" style="color: #2c5aa0"></i>
            </div>
            <div>
              <div class="fw-semibold">Agents</div>
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link d-flex align-items-center"
            [class.active]="activeTab() === 'policies'"
            (click)="setActiveTab('policies')"
            style="cursor: pointer"
          >
            <div
              class="icon-wrapper me-3"
              style="
                width: 40px;
                height: 40px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(44, 90, 160, 0.1);
              "
            >
              <i class="fas fa-file-contract" style="color: #2c5aa0"></i>
            </div>
            <div>
              <div class="fw-semibold">Policies</div>
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link d-flex align-items-center"
            [class.active]="activeTab() === 'claims'"
            (click)="setActiveTab('claims')"
            style="cursor: pointer"
          >
            <div
              class="icon-wrapper me-3"
              style="
                width: 40px;
                height: 40px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(44, 90, 160, 0.1);
              "
            >
              <i class="fas fa-file-medical" style="color: #2c5aa0"></i>
            </div>
            <div>
              <div class="fw-semibold">Claims</div>
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link d-flex align-items-center"
            [class.active]="activeTab() === 'customers'"
            (click)="setActiveTab('customers')"
            style="cursor: pointer"
          >
            <div
              class="icon-wrapper me-3"
              style="
                width: 40px;
                height: 40px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(44, 90, 160, 0.1);
              "
            >
              <i class="fas fa-user-friends" style="color: #2c5aa0"></i>
            </div>
            <div>
              <div class="fw-semibold">Customers</div>
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link d-flex align-items-center"
            [class.active]="activeTab() === 'policy-logs'"
            (click)="setActiveTab('policy-logs')"
            style="cursor: pointer"
          >
            <div
              class="icon-wrapper me-3"
              style="
                width: 40px;
                height: 40px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(44, 90, 160, 0.1);
              "
            >
              <i class="fas fa-history" style="color: #2c5aa0"></i>
            </div>
            <div>
              <div class="fw-semibold">Policy Logs</div>
            </div>
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="flex-grow-1 d-flex flex-column">
    <!-- Enhanced Top Navbar -->
    <nav class="navbar navbar-expand-lg shadow-sm" style="background: white">
      <div class="container-fluid">
        <div class="d-flex align-items-center">
          <div class="position-relative me-3">
            <div
              class="rounded-circle d-flex align-items-center justify-content-center"
              style="
                width: 50px;
                height: 50px;
                background: linear-gradient(135deg, #2c5aa0, #1e3d72);
                color: white;
                font-weight: bold;
                font-size: 18px;
              "
            >
              {{ adminInitials() }}
            </div>
            <div
              class="position-absolute bottom-0 end-0"
              style="
                width: 16px;
                height: 16px;
                background: #28a745;
                border: 2px solid white;
                border-radius: 50%;
              "
            ></div>
          </div>
          <div>
            <div class="fw-bold fs-5">{{ adminName() }}</div>
            <small class="text-muted">System Administrator</small>
          </div>
        </div>

        <div class="flex-grow-1 mx-3 mx-md-4">
          <div
            class="input-group"
            style="border-radius: 25px; overflow: hidden; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1)"
          >
            <span class="input-group-text" style="background: white; border: none; color: #667eea">
              <i class="fas fa-search"></i>
            </span>
            <input
              type="text"
              class="form-control"
              placeholder="Search agents, policies, claims, customers..."
              [(ngModel)]="searchTerm"
              style="border: none; padding: 12px 16px; font-size: 0.9rem"
              #searchInput
            />
            @if (searchTerm) {
            <button
              class="btn"
              style="background: white; border: none; color: #dc3545"
              (click)="clearSearch()"
            >
              <i class="fas fa-times"></i>
            </button>
            }
          </div>
        </div>

        <button
          class="btn"
          style="background: linear-gradient(135deg, #2c5aa0, #1e3d72); color: white; border: none"
          (click)="logout()"
        >
          <i class="fas fa-sign-out-alt me-2"></i>Logout
        </button>
      </div>
    </nav>

    <!-- Enhanced Content Area -->
    <div
      class="flex-grow-1 p-4 overflow-auto"
      style="background: linear-gradient(135deg, #f0f4f8, #d6e7f0)"
    >
      <!-- Dashboard Section -->
      @if (activeTab() === 'dashboard') {
      <div class="container-fluid">
        <div class="row mb-4">
          <div class="col">
            <h2><i class="fas fa-tachometer-alt me-2"></i>Admin Dashboard</h2>
          </div>
        </div>

        <div class="row g-3 mb-4">
          <div class="col-md-3">
            <div
              class="card h-100 shadow-sm"
              (click)="setActiveTab('agents')"
              style="cursor: pointer"
            >
              <div class="card-body d-flex align-items-center">
                <div class="text-white rounded p-3 me-3" style="background: rgb(234, 234, 7)">
                  <i class="fas fa-users fa-2x"></i>
                </div>
                <div>
                  <h3 class="card-title mb-1">{{ agents().length }}</h3>
                  <p class="card-text text-muted mb-0">
                    <i class="fas fa-user-tie me-1"></i>Total Agents
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div
              class="card h-100 shadow-sm"
              (click)="setActiveTab('policies')"
              style="cursor: pointer"
            >
              <div class="card-body d-flex align-items-center">
                <div class="text-white rounded p-3 me-3" style="background: rgb(221, 4, 4)">
                  <i class="fas fa-file-contract fa-2x"></i>
                </div>
                <div>
                  <h3 class="card-title mb-1">{{ policies().length }}</h3>
                  <p class="card-text text-muted mb-0">
                    <i class="fas fa-shield-alt me-1"></i>Total Policies
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div
              class="card h-100 shadow-sm"
              (click)="setActiveTab('claims')"
              style="cursor: pointer"
            >
              <div class="card-body d-flex align-items-center">
                <div class="text-white rounded p-3 me-3" style="background: rgb(215, 43, 172)">
                  <i class="fas fa-file-medical fa-2x"></i>
                </div>
                <div>
                  <h3 class="card-title mb-1">{{ claims().length }}</h3>
                  <p class="card-text text-muted mb-0">
                    <i class="fas fa-clipboard-list me-1"></i>Total Claims
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div
              class="card h-100 shadow-sm"
              (click)="setActiveTab('customers')"
              style="cursor: pointer"
            >
              <div class="card-body d-flex align-items-center">
                <div class="text-white rounded p-3 me-3" style="background: green">
                  <i class="fas fa-user-friends fa-2x"></i>
                </div>
                <div>
                  <h3 class="card-title mb-1">{{ customers().length }}</h3>
                  <p class="card-text text-muted mb-0">
                    <i class="fas fa-users me-1"></i>Total Customers
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
          </div>
          <div class="card-body">
            <div class="row g-2">
              <div class="col-md-4">
                <button
                  class="btn w-100"
                  style="
                    background: linear-gradient(135deg, #2c5aa0, #1e3d72);
                    color: white;
                    border: none;
                  "
                  (click)="setActiveTab('agents'); toggleAgentForm()"
                >
                  <i class="fas fa-user-plus me-2"></i>Add Agent
                </button>
              </div>
              <div class="col-md-4">
                <button
                  class="btn w-100"
                  style="
                    background: linear-gradient(135deg, #2c5aa0, #1e3d72);
                    color: white;
                    border: none;
                  "
                  (click)="setActiveTab('policies'); togglePolicyForm()"
                >
                  <i class="fas fa-plus-circle me-2"></i>Create Policy
                </button>
              </div>
              <div class="col-md-4">
                <button
                  class="btn w-100"
                  style="
                    background: linear-gradient(135deg, #2c5aa0, #1e3d72);
                    color: white;
                    border: none;
                  "
                  (click)="setActiveTab('claims')"
                >
                  <i class="fas fa-file-medical-alt me-2"></i>View Claims
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      }

      <!-- Agents Section -->
      @if (activeTab() === 'agents') {
      <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2>Agents Management</h2>
            <p class="text-muted">Manage insurance agents</p>
          </div>
          <button
            class="btn"
            style="
              background: linear-gradient(135deg, #2c5aa0, #1e3d72);
              color: white;
              border: none;
            "
            (click)="toggleAgentForm()"
          >
            <i class="fas fa-plus me-2"></i>Add Agent
          </button>
        </div>

        <!-- REACTIVE FORM - Agent Creation Form -->
        @if (showAgentForm()) {
        <div class="card mb-2">
          <div
            class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
          >
            <h5 class="mb-0"><i class="fas fa-user-plus me-2"></i>Create New Agent</h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              (click)="toggleAgentForm()"
            ></button>
          </div>
          <div class="card-body">
            <form [formGroup]="agentForm" (ngSubmit)="createAgent()">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Name *</label>
                  <input
                    type="text"
                    class="form-control"
                    formControlName="name"
                    placeholder="Agent Name"
                    [class.is-invalid]="
                      agentForm.get('name')?.invalid && agentForm.get('name')?.touched
                    "
                  />
                  <div class="invalid-feedback">{{ getFieldError(agentForm, 'name') }}</div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Email *</label>
                  <input
                    type="email"
                    class="form-control"
                    formControlName="contactInfo"
                    placeholder="Email Address"
                    [class.is-invalid]="
                      agentForm.get('contactInfo')?.invalid && agentForm.get('contactInfo')?.touched
                    "
                  />
                  <div class="invalid-feedback">{{ getFieldError(agentForm, 'contactInfo') }}</div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Password *</label>
                  <div class="input-group">
                    <input
                      [type]="showAgentPassword ? 'text' : 'password'"
                      class="form-control"
                      formControlName="password"
                      placeholder="Password (min 6 characters)"
                      [class.is-invalid]="
                        agentForm.get('password')?.invalid && agentForm.get('password')?.touched
                      "
                    />
                    <button
                      type="button"
                      class="btn btn-outline-secondary"
                      (click)="toggleAgentPassword()"
                    >
                      <i [class]="showAgentPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                    </button>
                  </div>
                  <div class="invalid-feedback d-block">
                    {{ getFieldError(agentForm, 'password') }}
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Gender *</label>
                  <select
                    class="form-select"
                    formControlName="gender"
                    [class.is-invalid]="
                      agentForm.get('gender')?.invalid && agentForm.get('gender')?.touched
                    "
                  >
                    <option value="">Select</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                  </select>
                  <div class="invalid-feedback">{{ getFieldError(agentForm, 'gender') }}</div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Aadhaar Number *</label>
                  <input
                    type="text"
                    class="form-control"
                    formControlName="aadharnumber"
                    placeholder="12-digit Aadhaar Number"
                    [class.is-invalid]="
                      agentForm.get('aadharnumber')?.invalid &&
                      agentForm.get('aadharnumber')?.touched
                    "
                  />
                  <div class="invalid-feedback">{{ getFieldError(agentForm, 'aadharnumber') }}</div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Phone *</label>
                  <input
                    type="text"
                    class="form-control"
                    formControlName="phone"
                    placeholder="10-digit Phone Number"
                    [class.is-invalid]="
                      agentForm.get('phone')?.invalid && agentForm.get('phone')?.touched
                    "
                  />
                  <div class="invalid-feedback">{{ getFieldError(agentForm, 'phone') }}</div>
                </div>
                <div class="col-12">
                  <label class="form-label">Organization Email *</label>
                  <input
                    type="email"
                    class="form-control"
                    formControlName="orgEmail"
                    placeholder="Organization Email Address"
                    [class.is-invalid]="
                      agentForm.get('orgEmail')?.invalid && agentForm.get('orgEmail')?.touched
                    "
                  />
                  <div class="invalid-feedback">{{ getFieldError(agentForm, 'orgEmail') }}</div>
                </div>
                <div class="col-12">
                  <label class="form-label">Address *</label>
                  <textarea
                    class="form-control"
                    formControlName="address"
                    placeholder="Complete Address"
                    rows="3"
                    [class.is-invalid]="
                      agentForm.get('address')?.invalid && agentForm.get('address')?.touched
                    "
                  ></textarea>
                  <div class="invalid-feedback">{{ getFieldError(agentForm, 'address') }}</div>
                </div>
              </div>
              <div class="mt-3">
                <button
                  type="button"
                  class="btn btn-outline-danger me-2"
                  (click)="toggleAgentForm()"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="btn btn-success"
                  [disabled]="agentForm.invalid || isCreatingAgent()"
                >
                  @if (isCreatingAgent()) {
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  } @else {
                  <i class="fas fa-save me-2"></i>
                  }
                  {{ isCreatingAgent() ? 'Creating...' : 'Create Agent' }}
                </button>
              </div>
            </form>
          </div>
        </div>
        }

        <!-- TEMPLATE-DRIVEN FORM - Update Agent Form (For Learning Comparison) -->
        @if (showUpdateForm()) {
        <div class="card mb-4">
          <div
            class="card-header bg-success text-white d-flex justify-content-between align-items-center"
          >
            <h5 class="mb-0">
              <i class="fas fa-edit me-2"></i>Update Agent
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              (click)="closeUpdateForm()"
            ></button>
          </div>
          <div class="card-body">
            <!-- Note: This uses template-driven approach with signals for comparison -->
            <form (ngSubmit)="updateAgent()">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Name</label>
                  <input
                    type="text"
                    class="form-control"
                    [value]="updateFormData().name"
                    (input)="onUpdateInputChange($event, 'name')"
                    placeholder="Agent Name"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Contact Info</label>
                  <input
                    type="email"
                    class="form-control"
                    [value]="updateFormData().contactInfo"
                    (input)="onUpdateInputChange($event, 'contactInfo')"
                    placeholder="Contact Info"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Gender</label>
                  <select
                    class="form-select"
                    [value]="updateFormData().gender"
                    (change)="onUpdateInputChange($event, 'gender')"
                  >
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Date</label>
                  <input
                    type="datetime-local"
                    class="form-control"
                    [value]="updateFormData().date"
                    (input)="onUpdateInputChange($event, 'date')"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Aadhaar Number</label>
                  <input
                    type="text"
                    class="form-control"
                    [value]="updateFormData().aadharnumber"
                    (input)="onUpdateInputChange($event, 'aadharnumber')"
                    placeholder="Aadhaar Number"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Phone</label>
                  <input
                    type="text"
                    class="form-control"
                    [value]="updateFormData().phone"
                    (input)="onUpdateInputChange($event, 'phone')"
                    placeholder="Phone Number"
                    required
                  />
                </div>
                <div class="col-12">
                  <label class="form-label">Organization Email</label>
                  <input
                    type="email"
                    class="form-control"
                    [value]="updateFormData().orgEmail"
                    (input)="onUpdateInputChange($event, 'orgEmail')"
                    placeholder="Organization Email"
                    required
                  />
                </div>
                <div class="col-12">
                  <label class="form-label">Address</label>
                  <textarea
                    class="form-control"
                    [value]="updateFormData().address"
                    (input)="onUpdateInputChange($event, 'address')"
                    placeholder="Address"
                    rows="3"
                    required
                  ></textarea>
                </div>
              </div>
              <div class="mt-3">
                <button type="button" class="btn btn-secondary me-2" (click)="closeUpdateForm()">
                  Cancel
                </button>
                <button type="submit" class="btn btn-success">
                  <i class="fas fa-save me-2"></i>Update Agent
                </button>
              </div>
            </form>
          </div>
        </div>
        }

        <!-- Agents Table -->
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Organization Email</th>
                    <th>Aadhaar Number</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  @for (agent of getFilteredAgents(); track agent.agentId || agent.id) {
                  <tr>
                    <td>{{ agent.agentId || agent.id }}</td>
                    <td>{{ agent.name }}</td>
                    <td>{{ agent.phone }}</td>
                    <td>{{ agent.orgEmail }}</td>
                    <td>{{ agent.aadharnumber }}</td>
                    <td>
                      <button
                        class="btn btn-sm btn-outline-success"
                        (click)="openUpdateForm(agent)"
                      >
                        <i class="fas fa-edit me-1"></i>Update
                      </button>
                    </td>
                  </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      }

      <!-- Claims Section -->
      @if (activeTab() === 'claims') {
      <div class="container-fluid">
        <div class="row mb-4">
          <div class="col">
            <h2>Claims Management</h2>
            <p class="text-muted">Monitor and manage insurance claims</p>
          </div>
        </div>

        <div class="card">
          <div class="card-body p-0">
            @if (getFilteredClaims().length === 0 && claims().length > 0) {
            <div class="text-center p-5">
              <i class="fas fa-search fa-3x text-muted mb-3"></i>
              <p class="text-muted">No claims match your search</p>
              <button class="btn btn-outline-primary" (click)="clearSearch()">
                <i class="fas fa-times me-2"></i>Clear Search
              </button>
            </div>
            } @else if (claims().length === 0) {
            <div class="text-center p-5">
              <i class="fas fa-file-medical fa-3x text-muted mb-3"></i>
              <p class="text-muted">No claims data available</p>
            </div>
            } @else {
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Claim ID</th>
                    <th>Policy ID</th>
                    <th>Customer ID</th>
                    <th>Amount</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  @for (claim of getFilteredClaims(); track claim.claimId || claim.id) {
                  <tr>
                    <td>
                      <span class="badge bg-secondary">{{
                        claim.claimId || claim.claim_id || claim.id || 'N/A'
                      }}</span>
                    </td>
                    <td>
                      <span class="badge bg-secondary">{{
                        claim.policyId || claim.policy_id || 'N/A'
                      }}</span>
                    </td>
                    <td>
                      <span class="badge bg-secondary">{{
                        claim.customerId || claim.customer_id || claim.userId || 'N/A'
                      }}</span>
                    </td>
                    <td>
                      <span class="fw-bold"
                        >₹{{
                          claim.claimAmount || claim.claim_amount || claim.amount || 0 | number
                        }}</span
                      >
                    </td>
                    <td>
                      <span class="badge bg-warning">{{
                        claim.status || claim.claimStatus || 'Pending'
                      }}</span>
                    </td>
                  </tr>
                  }
                </tbody>
              </table>
            </div>
            }
          </div>
        </div>
      </div>
      }

      <!-- Customers Section -->
      @if (activeTab() === 'customers') {
      <div class="container-fluid">
        <div class="row mb-4">
          <div class="col">
            <h2>Customers Management</h2>
            <p class="text-muted">View and manage customer information</p>
          </div>
        </div>

        <div class="card">
          <div class="card-body p-0">
            @if (getFilteredCustomers().length === 0 && customers().length > 0) {
            <div class="text-center p-5">
              <i class="fas fa-search fa-3x text-muted mb-3"></i>
              <p class="text-muted">No customers match your search</p>
              <button class="btn btn-outline-primary" (click)="clearSearch()">
                <i class="fas fa-times me-2"></i>Clear Search
              </button>
            </div>
            } @else {
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Address</th>
                  </tr>
                </thead>
                <tbody>
                  @for (customer of getFilteredCustomers(); track customer.customerId ||
                  customer.id) {
                  <tr>
                    <td>{{ customer.customerId || customer.id }}</td>
                    <td>{{ customer.name }}</td>
                    <td>{{ customer.email }}</td>
                    <td>{{ customer.phone }}</td>
                    <td>{{ customer.address }}</td>
                  </tr>
                  }
                </tbody>
              </table>
            </div>
            }
          </div>
        </div>
      </div>
      }

      <!-- Policies Section -->
      @if (activeTab() === 'policies') {
      <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2><i class="fas fa-file-contract me-2"></i>Policies Management</h2>
            <p class="text-muted">Manage insurance policies</p>
          </div>
          <div class="d-flex gap-2">
            <select class="form-select" [(ngModel)]="selectedPolicyType" style="width: auto">
              <option value="">All Types</option>
              <option value="Health">Health</option>
              <option value="Vehicle">Vehicle</option>
              <option value="Life">Life</option>
              <option value="Travel">Travel</option>
              <option value="Home">Home</option>
            </select>
            <button
              class="btn"
              style="
                background: linear-gradient(135deg, #2c5aa0, #1e3d72);
                color: white;
                border: none;
              "
              (click)="togglePolicyForm()"
            >
              <i class="fas fa-plus me-2"></i>Add Policy
            </button>
          </div>
        </div>

        <!-- REACTIVE FORM - Policy Creation Form -->
        @if (showPolicyForm()) {
        <div class="card mb-4">
          <div
            class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
          >
            <h5 class="mb-0">
              <i class="fas fa-plus-circle me-2"></i>Create New Policy (Reactive Form)
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              (click)="togglePolicyForm()"
            ></button>
          </div>
          <div class="card-body">
            <form [formGroup]="policyForm" (ngSubmit)="createPolicy()">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Policy Name *</label>
                  <input
                    type="text"
                    class="form-control"
                    formControlName="name"
                    placeholder="Policy Name"
                    [class.is-invalid]="
                      policyForm.get('name')?.invalid && policyForm.get('name')?.touched
                    "
                  />
                  <div class="invalid-feedback">{{ getFieldError(policyForm, 'name') }}</div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Policy Type *</label>
                  <select
                    class="form-select"
                    formControlName="policyType"
                    [class.is-invalid]="
                      policyForm.get('policyType')?.invalid && policyForm.get('policyType')?.touched
                    "
                  >
                    <option value="">Select Type</option>
                    <option value="Health">Health</option>
                    <option value="Vehicle">Vehicle</option>
                    <option value="Life">Life</option>
                    <option value="Travel">Travel</option>
                    <option value="Home">Home</option>
                  </select>
                  <div class="invalid-feedback">{{ getFieldError(policyForm, 'policyType') }}</div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Premium Amount *</label>
                  <input
                    type="number"
                    class="form-control"
                    formControlName="premiumAmount"
                    placeholder="Premium Amount"
                    [class.is-invalid]="
                      policyForm.get('premiumAmount')?.invalid &&
                      policyForm.get('premiumAmount')?.touched
                    "
                  />
                  <div class="invalid-feedback">
                    {{ getFieldError(policyForm, 'premiumAmount') }}
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Coverage Amount *</label>
                  <input
                    type="number"
                    class="form-control"
                    formControlName="coverageamount"
                    placeholder="Coverage Amount"
                    [class.is-invalid]="
                      policyForm.get('coverageamount')?.invalid &&
                      policyForm.get('coverageamount')?.touched
                    "
                  />
                  <div class="invalid-feedback">
                    {{ getFieldError(policyForm, 'coverageamount') }}
                  </div>
                </div>
                <div class="col-12">
                  <label class="form-label">Coverage Details *</label>
                  <textarea
                    class="form-control"
                    formControlName="coverageDetails"
                    placeholder="Coverage Details (minimum 10 characters)"
                    rows="3"
                    [class.is-invalid]="
                      policyForm.get('coverageDetails')?.invalid &&
                      policyForm.get('coverageDetails')?.touched
                    "
                  ></textarea>
                  <div class="invalid-feedback">
                    {{ getFieldError(policyForm, 'coverageDetails') }}
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <button
                  type="button"
                  class="btn btn-outline-danger me-2"
                  (click)="togglePolicyForm()"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="btn btn-success"
                  [disabled]="policyForm.invalid || isCreatingPolicy()"
                >
                  @if (isCreatingPolicy()) {
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  } @else {
                  <i class="fas fa-save me-2"></i>
                  }
                  {{ isCreatingPolicy() ? 'Creating...' : 'Create Policy' }}
                </button>
              </div>
            </form>
          </div>
        </div>
        }

        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Policy ID</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Premium Amount</th>
                    <th>Coverage Amount</th>
                    <th>Coverage Details</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  @for (policy of getFilteredPolicies(); track policy[1] || policy.policyId ||
                  policy.id) {
                  <tr>
                    <td>
                      <span class="badge bg-secondary">{{
                        policy[1] || policy.policy_id || policy.policyId || policy.id || 'N/A'
                      }}</span>
                    </td>
                    <td>
                      <strong>{{ policy[4] || policy.name || 'No Name' }}</strong>
                    </td>
                    <td>
                      <span class="badge bg-info">{{
                        policy.policyType || policy[5] || policy.policy_type || policy.type || 'N/A'
                      }}</span>
                    </td>
                    <td>
                      <span class="fw-bold"
                        >₹{{
                          policy[2] ||
                            policy.premium_amount ||
                            policy.premiumAmount ||
                            policy.premium ||
                            0 | number
                        }}</span
                      >
                    </td>
                    <td>
                      <span class="fw-bold"
                        >₹{{
                          policy[0] ||
                            policy.coverageamount ||
                            policy.coverageAmount ||
                            policy.coverage ||
                            0 | number
                        }}</span
                      >
                    </td>
                    <td>
                      {{
                        policy[3] ||
                          policy.coverage_details ||
                          policy.coverageDetails ||
                          policy.description ||
                          'No Description'
                      }}
                    </td>
                    <td>
                      <button
                        class="btn btn-sm btn-outline-danger"
                        (click)="
                          deletePolicy(
                            policy[1] || policy.policy_id || policy.policyId || policy.id
                          )
                        "
                      >
                        <i class="fas fa-trash me-1"></i>Delete
                      </button>
                    </td>
                  </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      }

      <!-- Policy Logs Section -->
      @if (activeTab() === 'policy-logs') {
      <div class="container-fluid">
        <div class="row mb-4">
          <div class="col">
            <h2><i class="fas fa-history me-2"></i>Policy Logs</h2>
            <p class="text-muted">View all policy transaction logs and history</p>
          </div>
        </div>

        <div class="card">
          <div class="card-body p-0">
            @if (policyLogs().length === 0) {
            <div class="text-center p-5">
              <i class="fas fa-history fa-3x text-muted mb-3"></i>
              <p class="text-muted">No policy logs available</p>
            </div>
            } @else { @if (getFilteredPolicyLogs().length === 0 && policyLogs().length > 0) {
            <div class="text-center p-5">
              <i class="fas fa-search fa-3x text-muted mb-3"></i>
              <p class="text-muted">No policy logs match your search</p>
              <button class="btn btn-outline-primary" (click)="clearSearch()">
                <i class="fas fa-times me-2"></i>Clear Search
              </button>
            </div>
            } @else {
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Policy ID</th>
                    <th>Customer ID</th>
                    <th>Agent ID</th>
                    <th>Status</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody>
                  @for (log of getFilteredPolicyLogs(); track log.id || $index; let i = $index) {
                  <tr>
                    <td>
                      <span class="badge bg-secondary">{{
                        log.policyId || log.policy_id || log.id || log.pId || 'P-' + (i + 1)
                      }}</span>
                    </td>
                    <td>
                      <span class="badge bg-secondary">{{
                        log.customerId || log.customer_id || log.userId || log.cId || 'C-' + (i + 1)
                      }}</span>
                    </td>
                    <td>
                      <span class="badge bg-secondary">{{
                        log.agentId || log.agent_id || log.createdBy || log.aId || 'A-' + (i + 1)
                      }}</span>
                    </td>
                    <td>
                      <span class="badge bg-success">{{
                        log.status || log.policyStatus || 'ACTIVE'
                      }}</span>
                    </td>
                    <td>{{ getFormattedDate(log) }}</td>
                  </tr>
                  }
                </tbody>
              </table>
            </div>
            } }
          </div>
        </div>
      </div>
      }
    </div>
  </div>
</div>
