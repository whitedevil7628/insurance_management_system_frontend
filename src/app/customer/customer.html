<div class="d-flex vh-100">
  <!-- Notification -->
  @if (showNotification) {
    <div class="alert position-fixed top-0 end-0 m-3"
         [class.alert-success]="notificationType === 'success'"
         [class.alert-danger]="notificationType === 'error'"
         style="z-index: 9999; min-width: 300px; max-width: 400px;">
      @if (notificationType === 'success') {
        <i class="fas fa-check-circle me-2"></i>
      }
      @if (notificationType === 'error') {
        <i class="fas fa-exclamation-circle me-2"></i>
      }
      {{ notificationMessage }}
    </div>
  }

  <!-- Enhanced Sidebar -->
  <div class="sidebar d-flex flex-column" style="min-width: 300px; max-width: 300px;">
    <div class="p-4 border-bottom">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <h4 class="mb-0 fw-bold">
            <i class="fas fa-shield-alt me-2" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
            Customer Portal
          </h4>
          <small class="text-muted">Insurance Management</small>
        </div>

      </div>
    </div>
    <nav class="flex-grow-1 p-3">
      <ul class="nav flex-column gap-2">
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center" [class.active]="activeSection === 'policies'" (click)="setActiveSection('policies')" style="cursor: pointer;">
            <div class="icon-wrapper me-3" style="width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; background: rgba(102, 126, 234, 0.1);">
              <i class="fas fa-list" style="color: #667eea;"></i>
            </div>
            <div>
              <div class="fw-semibold">All Policies</div>
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center" [class.active]="activeSection === 'myPolicies'" (click)="setActiveSection('myPolicies')" style="cursor: pointer;">
            <div class="icon-wrapper me-3" style="width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; background: rgba(102, 126, 234, 0.1);">
              <i class="fas fa-user-shield" style="color: #667eea;"></i>
            </div>
            <div>
              <div class="fw-semibold">My Policies</div>
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center" [class.active]="activeSection === 'notifications'" (click)="setActiveSection('notifications')" style="cursor: pointer;">
            <div class="icon-wrapper me-3 position-relative" style="width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; background: rgba(102, 126, 234, 0.1);">
              <i class="fas fa-bell" style="color: #667eea;"></i>
              @if (notifications.length > 0) {
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 10px;">{{ notifications.length }}</span>
              }
            </div>
            <div>
              <div class="fw-semibold">Notifications</div>
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center" [class.active]="activeSection === 'claims'" (click)="setActiveSection('claims')" style="cursor: pointer;">
            <div class="icon-wrapper me-3" style="width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; background: rgba(102, 126, 234, 0.1);">
              <i class="fas fa-file-medical" style="color: #667eea;"></i>
            </div>
            <div>
              <div class="fw-semibold">Claims</div>
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center" [class.active]="activeSection === 'profile'" (click)="setActiveSection('profile')" style="cursor: pointer;">
            <div class="icon-wrapper me-3" style="width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; background: rgba(102, 126, 234, 0.1);">
              <i class="fas fa-user" style="color: #667eea;"></i>
            </div>
            <div>
              <div class="fw-semibold">Profile</div>
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center" [class.active]="activeSection === 'help'" (click)="setActiveSection('help')" style="cursor: pointer;">
            <div class="icon-wrapper me-3" style="width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; background: rgba(102, 126, 234, 0.1);">
              <i class="fas fa-question-circle" style="color: #667eea;"></i>
            </div>
            <div>
              <div class="fw-semibold">Help</div>
            </div>
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="flex-grow-1 d-flex flex-column">
    <!-- Enhanced Top Navbar -->
    <nav class="navbar navbar-expand-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1rem 0; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
      <div class="container-fluid">
        <!-- Mobile Menu Button -->
        <button class="btn btn-link text-white d-lg-none me-3" (click)="toggleMobileMenu()" style="border: none; font-size: 1.2rem;">
          <i class="fas fa-bars"></i>
        </button>
        
        <!-- User Profile Section -->
        <div class="d-flex align-items-center">
          <div class="position-relative me-3">
            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; background: var(--primary-gradient); color: white; font-weight: bold; font-size: 18px;">
              {{ customerInitials }}
            </div>
            <div class="position-absolute bottom-0 end-0" style="width: 16px; height: 16px; background: #28a745; border: 2px solid white; border-radius: 50%;"></div>
          </div>
          <div>
            <div class="fw-bold fs-5">{{ customerName }}</div>
            <small class="text-muted">Customer ID: {{ customerId }}</small>
          </div>
        </div>
        
        <!-- Search Bar -->
        <div class="flex-grow-1 mx-3 mx-md-4">
          <div class="input-group" style="border-radius: 25px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <span class="input-group-text" style="background: white; border: none; color: #667eea;">
              <i class="fas fa-search"></i>
            </span>
            <input type="text" 
                   class="form-control" 
                   [placeholder]="getSearchPlaceholder()"
                   [(ngModel)]="searchTerm"
                   style="border: none; padding: 12px 16px; font-size: 0.9rem;"
                   #searchInput>
            @if (searchTerm) {
              <button class="btn" 
                      style="background: white; border: none; color: #dc3545;"
                      (click)="clearSearch(); searchInput.focus()">
                <i class="fas fa-times"></i>
              </button>
            }
          </div>
        </div>
        
        <button class="btn btn-primary" (click)="logout()">
          <i class="fas fa-sign-out-alt me-2"></i>Logout
        </button>
      </div>
    </nav>

    <!-- Enhanced Content Area -->
    <div class="flex-grow-1 p-4 overflow-auto" style="background: var(--bg-primary);">
      <!-- Notifications Section -->
      @if (activeSection === 'notifications') {
        <div class="container-fluid">
          <div class="row mb-4">
            <div class="col">
              <h2><i class="fas fa-bell me-2"></i>Notifications</h2>
              <p class="text-muted">Stay updated with important alerts and messages</p>
            </div>
          </div>
          
          @if (getFilteredNotifications().length > 0) {
            <div class="row g-3">
              @for (notification of getFilteredNotifications().slice().reverse(); track notification.id) {
                <div class="col-12">
                  <div class="card shadow-sm" style="cursor: pointer;" (click)="toggleNotificationExpand(notification)">
                    <div class="card-body">
                      <div class="d-flex align-items-start">
                        <div class="text-white rounded p-2 me-3" [ngClass]="getNotificationIconClass(notification.type)">
                          <i class="fas" [ngClass]="getNotificationIcon(notification.type)"></i>
                        </div>
                        <div class="flex-grow-1">
                          <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="mb-0">{{ notification.title || notification.type || 'General' }}</h6>
                            <div class="d-flex gap-2">
                              <button class="btn btn-sm btn-outline-primary" (click)="$event.stopPropagation()">
                                <i class="fas" [class.fa-chevron-down]="!notification.expanded" [class.fa-chevron-up]="notification.expanded"></i>
                              </button>
                              <button class="btn btn-sm btn-outline-success" (click)="markAsRead(notification, $event)">
                                <i class="fas fa-check"></i>
                              </button>
                            </div>
                          </div>
                          <p class="mb-2" style="color: var(--text-primary);">{{ notification.message || notification.content || 'New notification received' }}</p>
                          @if (notification.expanded) {
                            <div class="mt-3 p-3 bg-light rounded">
                              <h6 class="text-primary">Notification Details</h6>
                              <div class="row g-2 small">
                                <div class="col-12">
                                  <strong>ID:</strong> {{ notification.id }}
                                </div>
                                <div class="col-12">
                                  <strong>Type:</strong> {{ notification.type || 'General' }}
                                </div>
                                <div class="col-12">
                                  <strong>Priority:</strong> {{ notification.priority || 'Normal' }}
                                </div>
                                @if (notification.details) {
                                  <div class="col-12">
                                    <strong>Additional Details:</strong> {{ notification.details }}
                                  </div>
                                }
                              </div>
                            </div>
                          }
                          @if (notification.timestamp) {
                            <small class="text-muted">
                              <i class="fas fa-clock me-1"></i>{{ notification.timestamp }}
                            </small>
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="text-center py-5">
              <i class="fas fa-bell-slash fa-3x text-muted mb-3"></i>
              <h3>No Notifications</h3>
              <p class="text-muted">You're all caught up! No new notifications at this time.</p>
            </div>
          }
        </div>
      }

      <!-- All Policies Section -->
      @if (activeSection === 'policies') {
        <div class="container-fluid">
          <div class="row mb-4">
            <div class="col">
              <h2>Available Insurance Policies</h2>
              <p class="text-muted">Browse and explore our comprehensive insurance coverage options</p>
            </div>
          </div>
          
          <div class="row g-4">
            @for (policy of getFilteredPolicies(); track policy.policyId || policy.id) {
              <div class="col-md-6 col-xl-4">
                <div class="card h-100 shadow-sm border-0" style="border-radius: 12px; transition: all 0.3s ease;">
                  <div class="card-body p-3">
                    <!-- Header -->
                    <div class="d-flex align-items-center mb-3">
                      <div class="rounded-circle p-2 me-3" style="background: linear-gradient(135deg, #4169E1, #1E3A8A); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-shield-alt text-white" style="font-size: 0.9rem;"></i>
                      </div>
                      <div class="flex-grow-1">
                        <h6 class="mb-1 fw-bold text-dark" style="font-size: 0.95rem; line-height: 1.2;">{{ policy[4] || policy.name || 'No Name' }}</h6>
                        <span class="badge" style="background: #e3f2fd; color: #1976d2; font-size: 0.7rem; padding: 2px 8px;">{{ policy[5] || policy.policyType || policy.policy_type || policy.type || 'General' }}</span>
                      </div>
                    </div>
                    
                    <!-- Details Grid -->
                    <div class="mb-3">
                      <div class="row g-2 text-center">
                        <div class="col-6">
                          <div class="p-2" style="background: #f8f9fa; border-radius: 8px;">
                            <i class="fas fa-rupee-sign text-success mb-1" style="font-size: 0.8rem;"></i>
                            <div class="fw-bold" style="font-size: 0.85rem; color: #2c3e50;">₹{{ policy[2] || policy.premium_amount || policy.premiumAmount || policy.premium || 0 | number }}</div>
                            <small class="text-muted" style="font-size: 0.7rem;">Premium</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="p-2" style="background: #f8f9fa; border-radius: 8px;">
                            <i class="fas fa-umbrella text-primary mb-1" style="font-size: 0.8rem;"></i>
                            <div class="fw-bold" style="font-size: 0.85rem; color: #2c3e50;">₹{{ policy[0] || policy.coverageamount || policy.coverageAmount || policy.coverage || 0 | number }}</div>
                            <small class="text-muted" style="font-size: 0.7rem;">Coverage</small>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Description -->
                    <div class="mb-3">
                      <p class="text-muted mb-0" style="font-size: 0.8rem; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">{{ policy[3] || policy.coverage_details || policy.coverageDetails || policy.description || 'Comprehensive insurance coverage with full benefits and protection.' }}</p>
                    </div>
                    
                    <!-- Action Button -->
                    <div class="d-grid">
                      <button class="btn btn-primary" (click)="buyPolicy(policy)" [disabled]="isPolicyLoading" style="background: linear-gradient(135deg, #4169E1, #1E3A8A); border: none; font-size: 0.85rem; padding: 8px 16px; border-radius: 8px;">
                        <i class="fas fa-plus me-2" style="font-size: 0.8rem;"></i>Select Policy
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- My Policies Section -->
      @if (activeSection === 'myPolicies') {
        <div class="container-fluid">
          <div class="row mb-4">
            <div class="col">
              <h2>My Insurance Policies</h2>
              <p class="text-muted">Manage your active insurance policies and claims</p>
            </div>
          </div>
          
          @if (getFilteredMyPolicies().length > 0) {
            <div class="row g-3">
              @for (policy of getFilteredMyPolicies(); track policy.policyId) {
                <div class="col-md-6 col-lg-4">
                  <div class="card h-100 shadow-sm border-0" style="border-radius: 12px; transition: transform 0.2s ease;">
                    <div class="card-body" style="padding: 1.25rem;">
                      <!-- Header -->
                      <div class="d-flex align-items-center mb-3">
                        <div class="bg-success rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px; background: #1E3A8A !important;">
                          <i class="fas fa-user-shield" style="color: #ffffff;"></i>
                        </div>
                        <div class="flex-grow-1">
                          <h6 class="mb-1 fw-bold text-dark" style="font-size: 0.95rem; line-height: 1.3;">{{ policy.name }}</h6>
                          <span class="badge bg-success" style="font-size: 0.7rem; padding: 2px 8px;">{{ policy.policyType || 'Active Policy' }}</span>
                        </div>
                      </div>
                      
                      <!-- Premium & Coverage Grid -->
                      <div class="mb-3">
                        <div class="row g-2">
                          <div class="col-6">
                            <div class="p-2" style="background: #fff3cd; border-radius: 8px;">
                              <i class="fas fa-rupee-sign text-warning mb-1" style="font-size: 0.8rem;"></i>
                              <div class="fw-bold" style="font-size: 0.85rem; color: #2c3e50;">₹{{ policy.premiumAmount | number }}</div>
                              <small class="text-muted" style="font-size: 0.7rem;">Premium</small>
                            </div>
                          </div>
                          <div class="col-6">
                            <div class="p-2" style="background: #d1ecf1; border-radius: 8px;">
                              <i class="fas fa-umbrella text-info mb-1" style="font-size: 0.8rem;"></i>
                              <div class="fw-bold" style="font-size: 0.85rem; color: #2c3e50;">₹{{ policy.coverageAmount | number }}</div>
                              <small class="text-muted" style="font-size: 0.7rem;">Coverage</small>
                            </div>
                          </div>
                        </div>
                      </div>
                      
                      <!-- Description -->
                      <div class="mb-3">
                        <p class="text-muted mb-0" style="font-size: 0.8rem; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">Description: {{ policy.coverageDetails || 'Comprehensive insurance coverage with full benefits and protection.' }}</p>
                      </div>
                      
                      <!-- Action Button -->
                      <div class="d-grid">
                        <button class="btn" 
                                [class.btn-success]="!isPolicyClaimed(policy)"
                                [class.btn-secondary]="isPolicyClaimed(policy)"
                                (click)="openClaimForm(policy)" 
                                [disabled]="isPolicyClaimed(policy)"
                                style="font-size: 0.85rem; padding: 8px 16px; border-radius: 8px;">
                          <i class="fas me-2" 
                             [class.fa-file-medical]="!isPolicyClaimed(policy)" 
                             [class.fa-check-circle]="isPolicyClaimed(policy)" 
                             style="font-size: 0.8rem;"></i>
                          {{ isPolicyClaimed(policy) ? 'Already Claimed' : 'File Claim' }}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="text-center py-5">
              <i class="fas fa-file-contract fa-3x text-muted mb-3"></i>
              <h3>No Active Policies</h3>
              <p class="text-muted">You don't have any active insurance policies yet.</p>
              <button class="btn btn-dark btn-lg" (click)="setActiveSection('policies')">
                <i class="fas fa-search me-2"></i>Browse Policies
              </button>
            </div>
          }
        </div>
      }

      <!-- Claims Section -->
      @if (activeSection === 'claims') {
        <div class="container-fluid">
          <div class="row mb-4">
            <div class="col">
              <h2>My Claims</h2>
              <p class="text-muted">Track your insurance claims and their progress</p>
            </div>
          </div>
          
          @if (getFilteredClaims().length > 0) {
            <div class="row g-3">
              @for (claim of getFilteredClaims(); track claim.claimId) {
                <div class="col-md-6 col-lg-4">
                  <div class="card h-100 shadow-sm border-0 claim-card" style="border-radius: 12px;">
                    <div class="card-body" style="padding: 1.25rem;">
                      <!-- Header -->
                      <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle d-flex align-items-center justify-content-center me-3" 
                             style="width: 40px; height: 40px;"
                             [style.background]="claim.status === 'APPROVED' ? 'linear-gradient(135deg, #28a745, #20c997)' : claim.status === 'REJECTED' ? 'linear-gradient(135deg, #dc3545, #e74c3c)' : 'linear-gradient(135deg, #007bff, #0056b3)'">
                          <i class="fas text-white" 
                             [class.fa-check-circle]="claim.status === 'APPROVED'"
                             [class.fa-times-circle]="claim.status === 'REJECTED'"
                             [class.fa-clock]="claim.status === 'FILED'"
                             style="font-size: 0.9rem;"></i>
                        </div>
                        <div class="flex-grow-1">
                          <h6 class="mb-1 fw-bold text-dark" style="font-size: 0.95rem; line-height: 1.3;">Claim #{{ claim.claimId }}</h6>
                          <small class="text-muted" style="font-size: 0.75rem;">Policy ID: {{ claim.policyId }}</small>
                        </div>
                        <div class="text-end">
                          <span class="badge" style="font-size: 0.7rem; padding: 4px 8px;"
                                [class.bg-success]="claim.status === 'APPROVED'"
                                [class.bg-danger]="claim.status === 'REJECTED'"
                                [class.bg-primary]="claim.status === 'FILED'">
                            {{ claim.status }}
                          </span>
                        </div>
                      </div>
                      
                      <!-- Claim Amount -->
                      <div class="mb-4">
                        <div class="p-2" 
                             [style.background]="claim.status === 'APPROVED' ? '#d4edda' : claim.status === 'REJECTED' ? '#f8d7da' : '#e3f2fd'"
                             style="border-radius: 8px;">
                          <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                              <i class="fas fa-rupee-sign me-2" 
                                 [class.text-success]="claim.status === 'APPROVED'"
                                 [class.text-danger]="claim.status === 'REJECTED'"
                                 [class.text-primary]="claim.status === 'FILED'"
                                 style="font-size: 0.8rem;"></i>
                              <small class="text-muted" style="font-size: 0.7rem;">Claim Amount</small>
                            </div>
                            <div class="fw-bold" style="font-size: 0.9rem; color: #2c3e50;">₹{{ claim.claimAmount | number }}</div>
                          </div>
                        </div>
                      </div>
                      
                      <!-- Action Button -->
                      <div class="d-grid">
                        <button class="btn" 
                                [class.btn-success]="claim.status === 'APPROVED'"
                                [class.btn-danger]="claim.status === 'REJECTED'"
                                [class.btn-primary]="claim.status === 'FILED'"
                                style="font-size: 0.85rem; padding: 8px 16px; border-radius: 8px;"
                                [disabled]="true">
                          <i class="fas me-2" 
                             [class.fa-check]="claim.status === 'APPROVED'"
                             [class.fa-times]="claim.status === 'REJECTED'"
                             [class.fa-hourglass-half]="claim.status === 'FILED'"
                             style="font-size: 0.8rem;"></i>
                          @if (claim.status === 'APPROVED') {
                            Claim Approved
                          } @else if (claim.status === 'REJECTED') {
                            Claim Rejected
                          } @else {
                            Under Review
                          }
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="text-center py-5">
              <i class="fas fa-file-medical fa-3x text-muted mb-3"></i>
              <h3>No Claims Filed</h3>
              <p class="text-muted">You haven't filed any insurance claims yet.</p>
              <button class="btn btn-dark btn-lg" (click)="setActiveSection('myPolicies')">
                <i class="fas fa-folder-open me-2"></i>View My Policies
              </button>
            </div>
          }
        </div>
      }

      <!-- Profile Section -->
      @if (activeSection === 'profile') {
        <div class="container-fluid">
          <div class="row mb-4">
            <div class="col">
              <h2>Profile Settings</h2>
              <p class="text-muted">Update your personal information and account settings</p>
            </div>
          </div>
          
          <div class="row justify-content-center">
            <div class="col-md-8">
              <div class="card">
                <div class="card-header bg-primary" style="background-color: #2c5aa0 !important;">
                  <div class="d-flex align-items-center">
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px; border: 2px solid white; background-color: #2c5aa0 !important;">
                     <b>{{ customerInitials || 'N/A' }}</b>
                    </div>
                    <div>
                      <h5 style="color: white !important;;" class="mb-0 text-dark"><b>{{ customerName || 'Customer' }}</b></h5>
                      <small class="text-dark"style="color: white !important;;" >Customer ID: {{ customerId || 'N/A' }}</small>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
                    <div class="row g-3">
                      <div class="col-md-6">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control" formControlName="name" readonly style="cursor:not-allowed; background-color: #f8f9fa;">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-control" formControlName="email" readonly style="cursor:not-allowed; background-color: #f8f9fa;">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" formControlName="phone" placeholder="Enter phone number">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Gender</label>
                        <select class="form-select" formControlName="gender">
                          <option value="">Select Gender</option>
                          <option value="Male">Male</option>
                          <option value="Female">Female</option>
                          <option value="Other">Other</option>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Date of Birth</label>
                        <input type="date" class="form-control" formControlName="date">
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Aadhar Number</label>
                        <input type="text" class="form-control" formControlName="aadharnumber" placeholder="Enter 12-digit Aadhar number">
                      </div>
                      <div class="col-12">
                        <label class="form-label">Address</label>
                        <textarea class="form-control" formControlName="address" rows="3" placeholder="Enter your complete address"></textarea>
                      </div>
                    </div>
                    <div class="mt-3">
                      <button type="submit" class="btn btn-primary" [disabled]="isProfileLoading">
                        @if (isProfileLoading) {
                          <span class="spinner-border spinner-border-sm me-2"></span>
                        } @else {
                          <i class="fas fa-save me-1"></i>
                        }
                        {{ isProfileLoading ? 'Updating...' : 'Update Profile' }}
                      </button>
                      <button type="button" class="btn btn-outline-secondary ms-2" (click)="loadProfile()">
                        <i class="fas fa-refresh me-1"></i>Reload Profile
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      }

      <!-- Help Section -->
      @if (activeSection === 'help') {
        <div class="container-fluid">
          <div class="row mb-4">
            <div class="col">
              <h2>Help & Support</h2>
              <p class="text-muted">Get assistance with your insurance needs</p>
            </div>
          </div>
          
          <div class="row g-3">
            <div class="col-md-6">
              <div class="card">
                <div class="card-header bg-primary" style="background-color: #2c5aa0 !important;">
                  <h6 class="mb-0 text-dark" style="color: white !important;"><i class="fas fa-envelope me-2"></i>Contact Support</h6>
                </div>
                <div class="card-body">
                  <p>Need help with your insurance policies or claims? Contact our support team.</p>
                  <a href="mailto:support@securelife.com" class="btn btn-primary">
                    <i class="fas fa-paper-plane me-1"></i>Send Email
                  </a>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card">
                <div class="card-header bg-primary" style="background-color: #2c5aa0 !important;">
                  <h6 class="mb-0 text-dark" style="color: white !important;"><i class="fas fa-phone me-2"></i>Customer Hotline</h6>
                </div>
                <div class="card-body">
                  <p class="fw-bold">1-800-SECURE (1-800-732-873)</p>
                  <p class="text-success small">Available 24/7</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </div>

  <!-- Claim Form Modal -->
  @if (showClaimForm && selectedPolicy) {
    <div class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" (click)="closeClaimForm()">
      <div class="modal-dialog" (click)="$event.stopPropagation()">
        <div class="modal-content">
          <div class="modal-header text-white" >
            <h5 class="modal-title">
              <i class="fas fa-file-medical me-2"></i>File Insurance Claim
            </h5>
            <button type="button" class="btn-close btn-close-white" (click)="closeClaimForm()"></button>
          </div>
          <div class="modal-body">
            <form [formGroup]="claimForm" (ngSubmit)="submitClaim()">
              <div class="mb-3">
                <label class="form-label">Policy Name</label>
                <input type="text" class="form-control" formControlName="policyName" readonly>
              </div>
              <div class="mb-3">
                <label class="form-label">Policy ID</label>
                <input type="text" class="form-control" formControlName="policyId" readonly>
              </div>
              <div class="mb-3">
                <label class="form-label">Customer Name</label>
                <input type="text" class="form-control" formControlName="customerName" readonly>
              </div>
              <div class="mb-3">
                <label class="form-label">Maximum Coverage Amount</label>
                <div class="input-group">
                  <span class="input-group-text">₹</span>
                  <input type="text" class="form-control" formControlName="coverageAmount" readonly style="background-color: #e9ecef;">
                </div>
                <small class="form-text text-muted">Your claim amount cannot exceed this coverage limit</small>
              </div>
              <div class="mb-3">
                <label class="form-label">Claim Amount *</label>
                <div class="input-group">
                  <span class="input-group-text">₹</span>
                  <input type="number" 
                         class="form-control" 
                         formControlName="claimAmount" 
                         placeholder="Enter claim amount" 
                         required 
                         min="1" 
                         [max]="claimForm.get('coverageAmount')?.value"
                         step="0.01">
                </div>
                <small class="form-text text-muted">
                  Maximum allowed: ₹{{ claimForm.get('coverageAmount')?.value | number }}
                </small>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeClaimForm()">Cancel</button>
            <button type="button" class="btn btn-success" (click)="submitClaim()" [disabled]="isClaimLoading || claimForm.invalid">
              @if (isClaimLoading) {
                <span class="spinner-border spinner-border-sm me-2"></span>
              } @else {
                <i class="fas fa-file-medical me-2"></i>
              }
              {{ isClaimLoading ? 'Filing...' : 'File Claim' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  }
</div>