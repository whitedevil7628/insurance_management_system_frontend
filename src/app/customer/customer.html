<div class="customer-dashboard">
  <!-- Notification -->
  <div
    class="notification"
    [class.show]="showNotification"
    [class.success]="notificationType === 'success'"
    [class.error]="notificationType === 'error'"
  >
    <div class="notification-content">
      <i class="fas fa-check-circle" *ngIf="notificationType === 'success'"></i>
      <i class="fas fa-exclamation-circle" *ngIf="notificationType === 'error'"></i>
      <span>{{ notificationMessage }}</span>
    </div>
  </div>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="brand">
        <i class="fas fa-shield-alt"></i>
        <span>SecureLife</span>
      </div>
    </div>
    <nav class="sidebar-nav">
      <ul>
        <li [class.active]="activeSection === 'policies'" (click)="setActiveSection('policies')">
          <i class="fas fa-list"></i>
          <span>All Policies</span>
        </li>
        <li
          [class.active]="activeSection === 'myPolicies'"
          (click)="setActiveSection('myPolicies')"
        >
          <i class="fas fa-user-shield"></i>
          <span>My Policies</span>
        </li>
        <li [class.active]="activeSection === 'claims'" (click)="setActiveSection('claims')">
          <i class="fas fa-file-medical"></i>
          <span>Claims</span>
        </li>
        <li [class.active]="activeSection === 'profile'" (click)="setActiveSection('profile')">
          <i class="fas fa-user"></i>
          <span>Profile</span>
        </li>
        <li [class.active]="activeSection === 'help'" (click)="setActiveSection('help')">
          <i class="fas fa-question-circle"></i>
          <span>Help</span>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Navbar -->
    <header class="top-navbar">
      <div class="navbar-left">
        <div class="user-avatar">
          {{ customerInitials }}
        </div>
        <span class="user-name">{{ customerName }}</span>
      </div>

      <div class="navbar-center">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search policies..." [(ngModel)]="searchTerm" />
        </div>
      </div>

      <div class="navbar-right">
        <button class="notification-btn">
          <i class="fas fa-bell"></i>
          <span class="notification-badge">3</span>
        </button>
        <button class="logout-btn" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          Logout
        </button>
      </div>
    </header>

    <!-- Content Area -->
    <div class="content-area">
      <!-- All Policies Section -->
      <div *ngIf="activeSection === 'policies'" class="section">
        <div class="section-header">
          <h2>Available Insurance Policies</h2>
          <p>Browse and explore our comprehensive insurance coverage options</p>
        </div>

        <div class="policies-grid" *ngIf="!isLoading">
          <div class="policy-card" *ngFor="let policy of getFilteredPolicies()">
            <div class="policy-header">
              <div class="policy-icon">
                <i class="fas fa-shield-check"></i>
              </div>
              <h3>{{ policy.name }}</h3>
            </div>
            <div class="policy-details">
              <div class="detail-item">
                <span class="label">Name:</span>
                <span class="value">{{ policy.name || 'No Name' }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Type:</span>
                <span class="value">{{ policy.policy_type || 'N/A' }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Premium:</span>
                <span class="value">₹{{ policy.premium_amount || 0 | number }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Coverage:</span>
                <span class="value">₹{{ policy.coverageamount || 0 | number }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Details:</span>
                <span class="value">{{ policy.coverage_details || 'No Description' }}</span>
              </div>
            </div>
            <div class="policy-actions">
              <button class="btn-primary" (click)="buyPolicy(policy)" [disabled]="isLoading">Select Policy</button>
              <button class="btn-outline">View Details</button>
            </div>
          </div>
        </div>

        <div *ngIf="isLoading" class="loading-state">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading policies...</p>
        </div>
      </div>

      <!-- My Policies Section -->
      <div *ngIf="activeSection === 'myPolicies'" class="section">
        <div class="section-header">
          <h2>My Insurance Policies</h2>
          <p>Manage your active insurance policies and claims</p>
        </div>

        <div class="my-policies-container">
          <div class="policies-grid" *ngIf="myPolicies.length > 0">
            <div class="policy-card" *ngFor="let policy of myPolicies">
              <div class="policy-header">
                <div class="policy-icon">
                  <i class="fas fa-shield-check"></i>
                </div>
                <h3>{{ policy.name }}</h3>
              </div>
              <div class="policy-details">
                <div class="detail-item">
                  <span class="label">Name:</span>
                  <span class="value">{{ policy.name || 'No Name' }}</span>
                </div>
                <div class="detail-item">
                  <span class="label">Type:</span>
                  <span class="value">{{ policy.policyType || policy.policy_type || 'N/A' }}</span>
                </div>
                <div class="detail-item">
                  <span class="label">Premium:</span>
                  <span class="value">₹{{ policy.premiumAmount || policy.premium_amount || 0 | number }}</span>
                </div>
                <div class="detail-item">
                  <span class="label">Coverage:</span>
                  <span class="value">₹{{ policy.coverageAmount || policy.coverageamount || 0 | number }}</span>
                </div>
                <div class="detail-item">
                  <span class="label">Details:</span>
                  <span class="value">{{ policy.coverageDetails || policy.coverage_details || 'No Description' }}</span>
                </div>
                <div class="detail-item" *ngIf="policy.status">
                  <span class="label">Status:</span>
                  <span class="value status-active">{{ policy.status }}</span>
                </div>
              </div>
              <div class="policy-actions">
                <button class="btn-primary">Renew Policy</button>
                <button class="btn-outline" (click)="openClaimForm(policy)">File Claim</button>
              </div>
            </div>
          </div>

          <div class="empty-state" *ngIf="myPolicies.length === 0">
            <i class="fas fa-file-contract"></i>
            <h3>No Active Policies</h3>
            <p>You don't have any active insurance policies yet.</p>
            <button class="btn-primary" (click)="setActiveSection('policies')">
              Browse Policies
            </button>
          </div>
        </div>
      </div>

      <!-- Claims Section -->
      <div *ngIf="activeSection === 'claims'" class="section">
        <div class="section-header">
          <h2>My Claims</h2>
          <p>Track your insurance claims and their progress</p>
        </div>

        <div class="claims-container">
          <div class="claims-grid" *ngIf="customerClaims.length > 0">
            <div class="claim-card" *ngFor="let claim of customerClaims">
              <div class="claim-header">
                <div class="claim-icon" [style.background]="getStatusColor(claim.status)">
                  <i [class]="getStatusIcon(claim.status)"></i>
                </div>
                <div class="claim-info">
                  <h3>Claim #{{ claim.claimId }}</h3>
                  <p>Policy ID: {{ claim.policyId }}</p>
                </div>
              </div>
              <div class="claim-details">
                <div class="detail-item">
                  <span class="label">Claim Amount:</span>
                  <span class="value">₹{{ claim.claimAmount | number }}</span>
                </div>
                <div class="detail-item">
                  <span class="label">Status:</span>
                  <span
                    class="value status-badge"
                    [style.background]="getStatusColor(claim.status)"
                    >{{ claim.status }}</span
                  >
                </div>
              </div>
              <div class="claim-progress">
                <div class="progress-bar">
                  <div
                    class="progress-fill"
                    [style.width]="
                      claim.status === 'FILED'
                        ? '25%'
                        : claim.status === 'UNDER_REVIEW'
                        ? '50%'
                        : claim.status === 'APPROVED'
                        ? '100%'
                        : '75%'
                    "
                    [style.background]="getStatusColor(claim.status)"
                  ></div>
                </div>
                <div class="progress-text">{{ claim.status.replace('_', ' ') }}</div>
              </div>
            </div>
          </div>

          <div class="empty-state" *ngIf="customerClaims.length === 0">
            <i class="fas fa-file-medical"></i>
            <h3>No Claims Filed</h3>
            <p>You haven't filed any insurance claims yet.</p>
            <button class="btn-primary" (click)="setActiveSection('myPolicies')">
              View My Policies
            </button>
          </div>
        </div>
      </div>

      <!-- Help Section -->
      <div *ngIf="activeSection === 'help'" class="section">
        <div class="section-header">
          <h2>Help & Support</h2>
          <p>Get assistance with your insurance needs</p>
        </div>

        <div class="help-container">
          <div class="help-card">
            <div class="help-header">
              <i class="fas fa-envelope"></i>
              <h3>Contact Admin</h3>
            </div>
            <div class="help-content">
              <p>Need help? Send an email to our admin team for assistance.</p>
              <a
                href="mailto:admin@securelife.com?subject=Customer Support Request&body=Hello Admin,%0D%0A%0D%0AI need assistance with:%0D%0A%0D%0ACustomer ID: {{
                  customerId
                }}%0D%0AName: {{ customerName }}%0D%0A%0D%0APlease describe your issue here..."
                class="btn-primary"
              >
                <i class="fas fa-paper-plane"></i>
                Send Email to Admin
              </a>
            </div>
          </div>

          <div class="help-card">
            <div class="help-header">
              <i class="fas fa-phone"></i>
              <h3>Phone Support</h3>
            </div>
            <div class="help-content">
              <p>Call our customer service hotline:</p>
              <p class="phone-number">1-800-SECURE (1-800-732-873)</p>
              <p class="hours">Available 24/7</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Section -->
      <div *ngIf="activeSection === 'profile'" class="section">
        <div class="section-header">
          <h2>Profile Settings</h2>
          <p>Update your personal information and account settings</p>
        </div>

        <div class="profile-container">
          <div class="profile-card">
            <div class="profile-header">
              <div class="profile-avatar">
                {{ customerInitials }}
              </div>
              <div class="profile-info">
                <h3>{{ customerName }}</h3>
                <p>Customer ID: {{ customerId }}</p>
              </div>
            </div>

            <form [formGroup]="profileForm" (ngSubmit)="updateProfile()" class="profile-form">
              <div class="form-grid">
                <div class="form-group">
                  <label>Full Name</label>
                  <input type="text" formControlName="name" readonly class="readonly" />
                </div>
                <div class="form-group">
                  <label>Email Address</label>
                  <input type="email" formControlName="email" readonly class="readonly" />
                </div>
                <div class="form-group">
                  <label>Date of Birth</label>
                  <input type="date" formControlName="date" readonly class="readonly" />
                </div>
                <div class="form-group">
                  <label>Aadhaar Number</label>
                  <input type="text" formControlName="aadharnumber" readonly class="readonly" />
                </div>
                <div class="form-group">
                  <label>Gender</label>
                  <select formControlName="gender">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Phone Number</label>
                  <input type="tel" formControlName="phone" />
                </div>
              </div>

              <div class="form-group">
                <label>Address</label>
                <textarea formControlName="address" rows="2"></textarea>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn-primary" [disabled]="isLoading">
                  <span *ngIf="!isLoading"> <i class="fas fa-save"></i> Update Profile </span>
                  <span *ngIf="isLoading">
                    <i class="fas fa-spinner fa-spin"></i> Updating...
                  </span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Claim Form Modal -->
  <div class="modal-overlay" *ngIf="showClaimForm" (click)="closeClaimForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>File Insurance Claim</h3>
        <button class="close-btn" (click)="closeClaimForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form [formGroup]="claimForm" (ngSubmit)="submitClaim()" class="claim-form">
        <div class="form-grid">
          <div class="form-group">
            <label>Policy ID</label>
            <input type="text" formControlName="policyId" readonly />
          </div>
          <div class="form-group">
            <label>Policy Name</label>
            <input type="text" formControlName="policyName" readonly />
          </div>
          <div class="form-group">
            <label>Customer ID</label>
            <input type="text" formControlName="customerId" readonly />
          </div>
          <div class="form-group">
            <label>Customer Name</label>
            <input type="text" formControlName="customerName" readonly />
          </div>
        </div>

        <div class="form-group">
          <label>Claim Amount *</label>
          <input
            type="number"
            formControlName="claimAmount"
            placeholder="Enter claim amount"
            min="1"
            step="0.01"
          />
          <div
            class="error-message"
            *ngIf="claimForm.get('claimAmount')?.invalid && claimForm.get('claimAmount')?.touched"
          >
            Please enter a valid claim amount
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-outline" (click)="closeClaimForm()">Cancel</button>
          <button type="submit" class="btn-primary" [disabled]="claimForm.invalid || isLoading">
            <span *ngIf="!isLoading"> <i class="fas fa-file-medical"></i> Submit Claim </span>
            <span *ngIf="isLoading"> <i class="fas fa-spinner fa-spin"></i> Filing... </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
